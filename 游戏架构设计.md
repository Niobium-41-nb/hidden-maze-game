# 隐藏迷宫游戏 - 技术架构设计

## 1. 技术栈选择
- **前端**: HTML5 + CSS3 + JavaScript (ES6+)
- **图形渲染**: HTML5 Canvas 2D
- **游戏引擎**: 原生JavaScript实现，无外部依赖
- **构建工具**: 无需构建，直接浏览器运行

## 2. 项目结构
```
隐藏迷宫/
├── index.html          # 主页面
├── style.css           # 样式文件
├── game.js             # 游戏主逻辑
├── maze.js             # 迷宫生成算法
├── player.js           # 玩家控制逻辑
├── view.js             # 视野系统
└── ui.js               # 用户界面控制
```

## 3. 核心模块设计

### 3.1 迷宫模块 (maze.js)
- **Maze类**: 迷宫数据结构
  - 属性: width, height, cells, walls
  - 方法: generate(), getCell(), setWall()
- **生成算法**: 随机深度优先搜索(DFS)
- **路径验证**: 确保起点到终点可达

### 3.2 游戏核心 (game.js)
- **Game类**: 游戏主控制器
  - 属性: maze, player, viewMode, gameState
  - 方法: init(), update(), render(), reset()
- **游戏状态管理**: 开始、进行中、胜利、失败

### 3.3 玩家模块 (player.js)
- **Player类**: 玩家角色
  - 属性: x, y, moves, visitedCells
  - 方法: move(), canMove(), getPosition()
- **移动控制**: 鼠标点击移动，键盘备用

### 3.4 视野系统 (view.js)
- **ViewSystem类**: 视野管理
  - 属性: viewMode, visibleCells, exploredCells
  - 方法: updateVisibility(), getVisibleArea()
- **两种模式实现**:
  - 模式一: 永久显示已探索区域
  - 模式二: 仅显示当前视野区域

### 3.5 用户界面 (ui.js)
- **UIController类**: 界面控制
  - 属性: canvas, ctx, uiElements
  - 方法: drawMaze(), drawPlayer(), drawUI()
- **界面元素**:
  - 游戏画布
  - 控制面板
  - 状态显示
  - 模式切换按钮

## 4. 数据流设计
```
用户输入 → UI控制器 → 游戏核心 → 玩家移动 → 视野更新 → 渲染更新
```

## 5. 关键算法

### 5.1 迷宫生成算法 (DFS)
```javascript
function generateMaze(width, height) {
    // 1. 初始化所有单元格为未访问
    // 2. 从起点开始深度优先搜索
    // 3. 随机选择相邻未访问单元格
    // 4. 移除墙壁连接
    // 5. 标记为已访问
    // 6. 递归继续
    // 7. 确保终点可达
}
```

### 5.2 视野计算算法
```javascript
function calculateVisibleArea(playerX, playerY, viewRange) {
    // 1. 以玩家为中心计算3×3区域
    // 2. 根据墙壁阻挡调整视野
    // 3. 更新可见单元格集合
    // 4. 根据模式更新探索历史
}
```

## 6. 性能考虑
- **Canvas优化**: 使用离屏渲染减少重绘
- **内存管理**: 合理存储迷宫和探索状态
- **响应式设计**: 适应不同屏幕尺寸

## 7. 扩展性设计
- **关卡系统**: 支持固定关卡和随机生成
- **难度调节**: 迷宫大小和复杂度可配置
- **道具系统**: 预留接口用于未来扩展
- **保存/加载**: 游戏状态持久化支持